<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prime Move Life</title>
  <style>
    body { margin:0; background:#000; color:#fff; font-family: system-ui; }
    canvas { width:100%; height:70vh; display:block; background:#000; }
    .stats, .controls { padding:10px; text-align:center; background:#111; }
    button { padding:10px 20px; margin:5px; background:#333; color:#fff; border:none; border-radius:5px; }
  </style>
</head>
<body>

<!-- FIXED: canvas instead of div -->
<canvas id="canvas"></canvas>

<div class="stats">
  Step: <span id="step">0</span> |
  Scars: <span id="scars">0</span> |
  Level: <span id="level">0</span> |
  Active: <span id="active">0</span>
</div>

<div class="controls">
  <button id="playBtn">Play</button>
  <button id="resetBtn">Reset</button>
</div>

<script>
// ===== YOUR PRIME MOVE ENGINE =====
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const SIZE = 40;
let running = true;
let step = 0;

function resizeCanvas() {
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let grid = [];
const colors = ['#000', '#e74c3c', '#f39c12', '#f1c40f', '#2ecc71', '#3498db'];

function initGrid() {
  grid = [];
  for(let y=0; y<SIZE; y++) {
    grid[y] = [];
    for(let x=0; x<SIZE; x++) {
      grid[y][x] = [0,0];
    }
  }
  // Seed
  let cx = Math.floor(SIZE/2);
  let cy = Math.floor(SIZE/2);
  grid[cy][cx] = [1,0];
  grid[cy+2][cx] = [1,0];
  grid[cy][cx+2] = [1,0];
}
initGrid();

function getNeighbors(x,y) {
  let count = 0;
  for(let dy=-1; dy<=1; dy++) {
    for(let dx=-1; dx<=1; dx++) {
      if(dx===0 && dy===0) continue;
      let ny = (y+dy+SIZE)%SIZE;
      let nx = (x+dx+SIZE)%SIZE;
      if(grid[ny][nx][0] !== 0) count++;
    }
  }
  return count;
}

function update() {
  if(!running) return;
  
  let newGrid = grid.map(row => row.map(cell => [...cell]));
  
  for(let y=0; y<SIZE; y++) {
    for(let x=0; x<SIZE; x++) {
      let [state, level] = grid[y][x];
      let neighbors = getNeighbors(x,y);
      
      if(state === 0 && neighbors >= 1) newGrid[y][x] = [1, level];
      else if(state === 1) newGrid[y][x] = [2, level];
      else if(state === 2 && neighbors >= 2) newGrid[y][x] = [3, level];
      else if(state === 3) newGrid[y][x] = [4, level];
      else if(state === 4) newGrid[y][x] = [5, level];
      else if(state === 5) {
        newGrid[y][x] = [1, level];
        if(Math.random() < 0.2) {
          let dx = Math.floor(Math.random()*3)-1;
          let dy = Math.floor(Math.random()*3)-1;
          let nx = (x+dx+SIZE)%SIZE;
          let ny = (y+dy+SIZE)%SIZE;
          newGrid[ny][nx] = [0, level+1];
        }
      }
    }
  }
  
  grid = newGrid;
  step++;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cellSize = canvas.width/SIZE;
  let totalScars=0, maxLevel=0, active=0;
  
  for(let y=0; y<SIZE; y++) {
    for(let x=0; x<SIZE; x++) {
      let [state, level] = grid[y][x];
      if(state===0 && level===0) continue;
      
      active++;
      totalScars += level;
      maxLevel = Math.max(maxLevel, level);
      
      ctx.fillStyle = colors[state];
      ctx.globalAlpha = Math.min(0.3 + level*0.1, 0.9);
      ctx.fillRect(x*cellSize, y*cellSize, cellSize-1, cellSize-1);
    }
  }
  
  document.getElementById('step').textContent = step;
  document.getElementById('scars').textContent = totalScars;
  document.getElementById('level').textContent = maxLevel;
  document.getElementById('active').textContent = active;
  
  requestAnimationFrame(draw);
}

// Loop
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

// Controls
document.getElementById('playBtn').onclick = () => running = !running;
document.getElementById('resetBtn').onclick = () => { initGrid(); step=0; running=true; };
</script>
</body>
</html>
